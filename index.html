<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Profile Card</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="./css/main.css">
  <link rel="stylesheet" href="./css/events.css">
  <link rel="stylesheet" href="./css/notification.css">
  <link rel="stylesheet" href="./css/wallet.css">
  <link rel="stylesheet" href="./css/keyboard.css">
  <style>
  </style>
</head>

<body>
  <div id="content" class="main-container">
    <div class="user-container">
      <div class="user-image">
        <img class="user-photo" id="user-photo" src="./img/avatar.png" alt="Avatar" />
      </div>
      <div class="user-name" id="user-name">Имя Фамилия</div>
      <div class="registration-date" id="reg-date">
        Дата регистрации: 21 июня 2024
      </div>
    </div>
    <div class="code">
      <div class="text-code">Мой код:</div>
      <div class="code-container">
        <div class="code-base" id="user-code">XXXX-XXXX</div>
      </div>
    </div>
    <div class="navbar">
      <div class="nav-item">
        <img class="nav-icon" src="./img/icons/user.svg" />
      </div>
      <div class="nav-item">
        <img class="nav-icon" src="./img/icons/apps.svg" />
      </div>
      <div class="nav-item">
        <img class="nav-icon" src="./img/icons/wallet.svg" />
      </div>
    </div>
  </div>
  <div class="event-container ">
    <div class="event-item">
      <img src="./img/Rectangle.png" alt="" class="event-image">
      <div class="event-info">
        <div class="event-name-container">
          <span class="event-name">Название</span>
          <span class="event-price">1000 ₽</span>
        </div>
        <div class="event-date-container">
          <span class="event-date">Дата проведения: 21 июня 2024</span>
          <div class="event-adress-container">
            <span class="event-adress">Адрес: <span class="event-adress-link">улица Пушкина дом
                Колотушкина</span></span>
            <img src="./img/icons/copy.svg" alt="" class="copy-icon">
          </div>
        </div>
      </div>
      <div class="buy-button purchased">Куплено</div>
    </div>
    <div class="event-item">
      <img src="./img/Rectangle.png" alt="" class="event-image">
      <div class="event-info">
        <div class="event-name-container">
          <span class="event-name">Название</span>
          <span class="event-price">1000 ₽</span>
        </div>
        <div class="event-date-container">
          <span class="event-date">Дата проведения: 21 июня 2024</span>
          <div class="event-adress-container">
            <span class="event-adress">Адрес: <span class="event-adress-link">улица Пушкина дом
                Колотушкина</span></span>
            <img src="./img/icons/copy.svg" alt="" class="copy-icon">
          </div>
        </div>
      </div>
      <div class="buy-button">Купить билет</div>
    </div>
  </div>
  <div class="wallet-container">
    <img src="./img/card.png" alt="" class="card-image">
    <div class="balance">
      <div class="balance-text">Баланс:</div>
      <div class="balance-value">1000 С</div>
    </div>
    <div class="calculator-container">
      <div class="spend-container">
        <span class="spend-text">Заплачу</span>
        <div class="input-wrapper">
          <input type="text" id="visualInput" class="ruble-flex-input" placeholder="0" inputmode="numeric" readonly />
          <span class="ruble-symbol" id="visualRuble">₽</span>
        </div>
      </div>
      <div class="line"></div>
      <img src="./img/icons/swap.svg" class="swap-icon" alt="" />
      <div class="give-container">
        <span class="give-text">Получу</span>
        <div class="input-wrapper">
          <input type="text" id="giveInput" class="ruble-flex-input" placeholder="0" inputmode="numeric" readonly />
          <span class="ruble-symbol" id="giveRuble">С</span>
        </div>
      </div>
    </div>

    <input type="hidden" id="realInput" />

    <div class="balance-button" id="balanceButton">Пополнить баланс</div>
  </div>
  <div id="copy-notification" style="display: none;" class="copy-notification">
    Адрес скопирован!
  </div>

  <div class="keyboard-container" id="keyboard">
    <div class="keyboard">
      <button>1</button>
      <button>2</button>
      <button>3</button>
      <button>4</button>
      <button>5</button>
      <button>6</button>
      <button>7</button>
      <button>8</button>
      <button>9</button>
      <button>0</button>
      <button>00</button>
      <button>⌫</button>
    </div>
  </div>
  <div class="overlay" id="overlay">
  </div>

  <!-- Вставьте этот код перед закрывающим тегом </body> -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const balanceButton = document.querySelector('.balance-button');

      balanceButton.addEventListener('click', async function () {
        console.log('Кнопка нажата'); // Для отладки

        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe.user;

        if (!user || !user.id) {
          alert('Пожалуйста, войдите через Telegram');
          return;
        }

        const amount = document.getElementById('realInput').value;
        if (!amount || amount === '0') {
          alert('Пожалуйста, введите сумму');
          return;
        }

        const userId = user.id.toString();
        const username = user.username || `${user.first_name} ${user.last_name || ''}`.trim();

        try {
          console.log('Создание платежа...'); // Для отладки

          // Инициализация Firebase (если еще не сделано)
          if (!firebase.apps.length) {
            firebase.initializeApp({
              apiKey: "AIzaSyB80f5g7oANki4mhGSTtf9BQ_q_FBVoyt0",
              authDomain: "sssueta-club.firebaseapp.com",
              projectId: "sssueta-club",
              storageBucket: "sssueta-club.appspot.com",
              messagingSenderId: "243713908879",
              appId: "1:243713908879:web:36f19a718c7ee7584110fa",
            });
          }

          const db = firebase.firestore();

          // Создаем запись о платеже
          const paymentRef = await db.collection('payments').add({
            userId: userId,
            username: username,
            amount: parseInt(amount),
            status: 'pending',
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          console.log('Платеж создан, ID:', paymentRef.id); // Для отладки

          // Отправляем данные через Telegram WebApp
          if (tg.sendData) {
            tg.sendData(JSON.stringify({
              type: 'payment_request',
              paymentId: paymentRef.id,
              amount: amount,
              userId: userId,
              username: username
            }));
            alert('Запрос отправлен. Проверьте чат с ботом для получения реквизитов.');
          } else {
            alert('Ошибка: функция sendData недоступна');
          }
        } catch (error) {
          console.error('Ошибка:', error);
          alert('Произошла ошибка: ' + error.message);
        }
      });
    });
  </script>




  <script src="./js/user_Info.js"></script>
  <script src="./js/open_Events.js"></script>
  <script src="./js/open_Wallet.js"></script>
  <script src="./js/copy.js"></script>
  <script src="./js/giveSpendNums.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="./js/firebase.js"></script>

</body>

</html>